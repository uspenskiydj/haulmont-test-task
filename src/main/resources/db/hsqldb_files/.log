/*C16*/SET SCHEMA PUBLIC
DROP TABLE payments IF EXISTS CASCADE
DROP TABLE credit_proposals IF EXISTS CASCADE
DROP TABLE credits IF EXISTS
DROP TABLE customers IF EXISTS
DROP TABLE banks IF EXISTS
CREATE TABLE banks\u000a(\u000a    id               UUID      PRIMARY KEY\u000a)
CREATE TABLE customers\u000a(\u000a    id               UUID      PRIMARY KEY,\u000a    fio              VARCHAR(255)   NOT NULL,\u000a    phone_number     VARCHAR(255)   NOT NULL,\u000a    email            VARCHAR(255)   NOT NULL,\u000a    passport_number  VARCHAR(255)   NOT NULL,\u000a    bank_id          UUID      NOT NULL,\u000a    FOREIGN KEY (bank_id) REFERENCES banks (id) ON DELETE CASCADE\u000a)
CREATE TABLE credits\u000a(\u000a    id               UUID      PRIMARY KEY,\u000a    limit            DECIMAL   NOT NULL,\u000a    interest_rate    DECIMAL   NOT NULL,\u000a    bank_id          UUID      NOT NULL,\u000a    FOREIGN KEY (bank_id) REFERENCES banks (id) ON DELETE CASCADE\u000a)
CREATE TABLE credit_proposals\u000a(\u000a    id               UUID      PRIMARY KEY,\u000a    credit_amount    DECIMAL   NOT NULL,\u000a    customer_id      UUID      NOT NULL,\u000a    credit_id        UUID      NOT NULL,\u000a    FOREIGN KEY (customer_id) REFERENCES customers (id) ON DELETE CASCADE,\u000a    FOREIGN KEY (credit_id) REFERENCES credits (id) ON DELETE CASCADE\u000a)
CREATE TABLE payments\u000a(\u000a    id                UUID        PRIMARY KEY,\u000a    date              TIMESTAMP   NOT NULL,\u000a    total_amount      Decimal     NOT NULL,\u000a    amount_of_credit_body_repayment   Decimal   NOT NULL,\u000a    amount_of_interest_repayment      Decimal   NOT NULL,\u000a    credit_proposal_id                UUID      NOT NULL,\u000a    FOREIGN KEY (credit_proposal_id) REFERENCES credit_proposals (id) ON DELETE CASCADE\u000a)
DISCONNECT
/*C17*/SET SCHEMA PUBLIC
DISCONNECT
/*C18*/SET SCHEMA PUBLIC
DROP PROCEDURE populate_db IF EXISTS
DISCONNECT
/*C19*/SET SCHEMA PUBLIC
DISCONNECT
/*C20*/SET SCHEMA PUBLIC
DROP PROCEDURE populate_db IF EXISTS
CREATE PROCEDURE populate_db()\u000a    MODIFIES SQL DATA\u000aBEGIN\u000a    ATOMIC\u000a    DECLARE bank_id1, bank_id2, customer_id1, customer_id2, customer_id3, credit_id1, credit_id2,\u000a        credit_id3, credit_proposal_id1, credit_proposal_id2, credit_proposal_id3 UUID;\u000a    SET bank_id1 = UUID();\u000a    SET bank_id2 = UUID();\u000a    SET customer_id1 = UUID();\u000a    SET customer_id2 = UUID();\u000a    SET customer_id3 = UUID();\u000a    SET credit_id1 = UUID();\u000a    SET credit_id2 = UUID();\u000a    SET credit_id3 = UUID();\u000a    SET credit_proposal_id1 = UUID();\u000a    SET credit_proposal_id2 = UUID();\u000a    SET credit_proposal_id3 = UUID();\u000a\u000a    DELETE FROM payments;\u000a    DELETE FROM credit_proposals;\u000a    DELETE FROM credits;\u000a    DELETE FROM customers;\u000a    DELETE FROM banks;\u000a\u000a    INSERT INTO banks (id)\u000a    VALUES (bank_id1),\u000a           (bank_id2);\u000a\u000a    INSERT INTO customers (id, fio, phone_number, email, passport_number, bank_id)\u000a    VALUES (customer_id1, 'fio1', 'phone1', 'email1', 'pas1', bank_id1),\u000a           (customer_id2, 'fio2', 'phone2', 'email2', 'pas2', bank_id1),\u000a           (customer_id3, 'fio3', 'phone3', 'email3', 'pas3', bank_id2);\u000a\u000a    INSERT INTO credits (id, limit, interest_rate, bank_id)\u000a    VALUES (credit_id1, 100.5, 10.5, bank_id1),\u000a           (credit_id2, 200.5, 20.5, bank_id1),\u000a           (credit_id3, 300.5, 30.5, bank_id2);\u000a\u000a    INSERT INTO credit_proposals (id, credit_amount, customer_id, credit_id)\u000a    VALUES (credit_proposal_id1, 50.5, customer_id1, credit_id1),\u000a           (credit_proposal_id2, 150.5, customer_id2, credit_id2),\u000a           (credit_proposal_id3, 250.5, customer_id3, credit_id3);\u000a\u000a    INSERT INTO payments (id, date, total_amount, amount_of_credit_body_repayment,\u000a                          amount_of_interest_repayment, credit_proposal_id)\u000a    VALUES (UUID(), '2021-01-25', 100.5, 90.3, 10.2, credit_proposal_id1),\u000a           (UUID(), '2021-02-25', 200.5, 180.3, 20.2, credit_proposal_id2),\u000a           (UUID(), '2021-03-25', 300.5, 270.3, 30.2, credit_proposal_id3);\u000aEND
INSERT INTO BANKS VALUES('b8d2ee15-94a1-4c40-982d-3992b6a3c69f')
INSERT INTO BANKS VALUES('b1f6fb8d-fbf3-4c66-9449-b6f6847196b5')
INSERT INTO CUSTOMERS VALUES('1cf2803d-7d66-477f-ab50-40a3fbe601dd','fio1','phone1','email1','pas1','b8d2ee15-94a1-4c40-982d-3992b6a3c69f')
INSERT INTO CUSTOMERS VALUES('e853d2c9-0455-4ab7-9fba-b692ba5ccde9','fio2','phone2','email2','pas2','b8d2ee15-94a1-4c40-982d-3992b6a3c69f')
INSERT INTO CUSTOMERS VALUES('70c112fe-4338-4069-b2c2-e9569696e965','fio3','phone3','email3','pas3','b1f6fb8d-fbf3-4c66-9449-b6f6847196b5')
INSERT INTO CREDITS VALUES('a86aab46-ed82-402d-92bd-c8c028aba93a',100,10,'b8d2ee15-94a1-4c40-982d-3992b6a3c69f')
INSERT INTO CREDITS VALUES('fef01bfd-fcee-4795-ba51-52073490c7c0',200,20,'b8d2ee15-94a1-4c40-982d-3992b6a3c69f')
INSERT INTO CREDITS VALUES('aeb38984-0da4-4a4b-acd7-f85eac28a086',300,30,'b1f6fb8d-fbf3-4c66-9449-b6f6847196b5')
INSERT INTO CREDIT_PROPOSALS VALUES('d3372a6f-a62f-443f-a790-2a1aa4eef297',50,'1cf2803d-7d66-477f-ab50-40a3fbe601dd','a86aab46-ed82-402d-92bd-c8c028aba93a')
INSERT INTO CREDIT_PROPOSALS VALUES('e702ffcc-871a-413e-9bbc-e6887a7e8e93',150,'e853d2c9-0455-4ab7-9fba-b692ba5ccde9','fef01bfd-fcee-4795-ba51-52073490c7c0')
INSERT INTO CREDIT_PROPOSALS VALUES('e6bd9019-f8bc-4217-84d2-ad675bfa410d',250,'70c112fe-4338-4069-b2c2-e9569696e965','aeb38984-0da4-4a4b-acd7-f85eac28a086')
INSERT INTO PAYMENTS VALUES('467a5fe7-153c-4313-96ed-7b789a033ed3','2021-01-25 00:00:00.000000',100,90,10,'d3372a6f-a62f-443f-a790-2a1aa4eef297')
INSERT INTO PAYMENTS VALUES('97c83f2a-ddb3-4103-8f2c-4eae8f4e9c6c','2021-02-25 00:00:00.000000',200,180,20,'e702ffcc-871a-413e-9bbc-e6887a7e8e93')
INSERT INTO PAYMENTS VALUES('888858d8-4c7f-4530-9936-e0c2330cd84e','2021-03-25 00:00:00.000000',300,270,30,'e6bd9019-f8bc-4217-84d2-ad675bfa410d')
COMMIT
DISCONNECT
/*C21*/SET SCHEMA PUBLIC
DISCONNECT
/*C22*/SET SCHEMA PUBLIC
DISCONNECT
/*C23*/SET SCHEMA PUBLIC
DROP TABLE payments IF EXISTS CASCADE
DROP TABLE credit_proposals IF EXISTS CASCADE
DROP TABLE credits IF EXISTS
DROP TABLE customers IF EXISTS
DROP TABLE banks IF EXISTS
CREATE TABLE banks\u000a(\u000a    id               UUID      PRIMARY KEY\u000a)
CREATE TABLE customers\u000a(\u000a    id               UUID      PRIMARY KEY,\u000a    fio              VARCHAR(255)   NOT NULL,\u000a    phone_number     VARCHAR(255)   NOT NULL,\u000a    email            VARCHAR(255)   NOT NULL,\u000a    passport_number  VARCHAR(255)   NOT NULL,\u000a    bank_id          UUID      NOT NULL,\u000a    FOREIGN KEY (bank_id) REFERENCES banks (id) ON DELETE CASCADE\u000a)
CREATE TABLE credits\u000a(\u000a    id               UUID      PRIMARY KEY,\u000a    limit            DECIMAL   NOT NULL,\u000a    interest_rate    DECIMAL   NOT NULL,\u000a    bank_id          UUID      NOT NULL,\u000a    FOREIGN KEY (bank_id) REFERENCES banks (id) ON DELETE CASCADE\u000a)
CREATE TABLE credit_proposals\u000a(\u000a    id               UUID      PRIMARY KEY,\u000a    credit_amount    DECIMAL   NOT NULL,\u000a    customer_id      UUID      NOT NULL,\u000a    credit_id        UUID      NOT NULL,\u000a    FOREIGN KEY (customer_id) REFERENCES customers (id) ON DELETE CASCADE,\u000a    FOREIGN KEY (credit_id) REFERENCES credits (id) ON DELETE CASCADE\u000a)
CREATE TABLE payments\u000a(\u000a    id                UUID        PRIMARY KEY,\u000a    date              Date        NOT NULL,\u000a    total_amount      Decimal     NOT NULL,\u000a    amount_of_credit_body_repayment   Decimal   NOT NULL,\u000a    amount_of_interest_repayment      Decimal   NOT NULL,\u000a    credit_proposal_id                UUID      NOT NULL,\u000a    FOREIGN KEY (credit_proposal_id) REFERENCES credit_proposals (id) ON DELETE CASCADE\u000a)
DISCONNECT
/*C24*/SET SCHEMA PUBLIC
DISCONNECT
/*C25*/SET SCHEMA PUBLIC
DROP PROCEDURE populate_db IF EXISTS
CREATE PROCEDURE populate_db()\u000a    MODIFIES SQL DATA\u000aBEGIN\u000a    ATOMIC\u000a    DECLARE bank_id1, bank_id2, customer_id1, customer_id2, customer_id3, credit_id1, credit_id2,\u000a        credit_id3, credit_proposal_id1, credit_proposal_id2, credit_proposal_id3 UUID;\u000a    SET bank_id1 = UUID();\u000a    SET bank_id2 = UUID();\u000a    SET customer_id1 = UUID();\u000a    SET customer_id2 = UUID();\u000a    SET customer_id3 = UUID();\u000a    SET credit_id1 = UUID();\u000a    SET credit_id2 = UUID();\u000a    SET credit_id3 = UUID();\u000a    SET credit_proposal_id1 = UUID();\u000a    SET credit_proposal_id2 = UUID();\u000a    SET credit_proposal_id3 = UUID();\u000a\u000a    DELETE FROM payments;\u000a    DELETE FROM credit_proposals;\u000a    DELETE FROM credits;\u000a    DELETE FROM customers;\u000a    DELETE FROM banks;\u000a\u000a    INSERT INTO banks (id)\u000a    VALUES (bank_id1),\u000a           (bank_id2);\u000a\u000a    INSERT INTO customers (id, fio, phone_number, email, passport_number, bank_id)\u000a    VALUES (customer_id1, 'fio1', 'phone1', 'email1', 'pas1', bank_id1),\u000a           (customer_id2, 'fio2', 'phone2', 'email2', 'pas2', bank_id1),\u000a           (customer_id3, 'fio3', 'phone3', 'email3', 'pas3', bank_id2);\u000a\u000a    INSERT INTO credits (id, limit, interest_rate, bank_id)\u000a    VALUES (credit_id1, 100.5, 10.5, bank_id1),\u000a           (credit_id2, 200.5, 20.5, bank_id1),\u000a           (credit_id3, 300.5, 30.5, bank_id2);\u000a\u000a    INSERT INTO credit_proposals (id, credit_amount, customer_id, credit_id)\u000a    VALUES (credit_proposal_id1, 50.5, customer_id1, credit_id1),\u000a           (credit_proposal_id2, 150.5, customer_id2, credit_id2),\u000a           (credit_proposal_id3, 250.5, customer_id3, credit_id3);\u000a\u000a    INSERT INTO payments (id, date, total_amount, amount_of_credit_body_repayment,\u000a                          amount_of_interest_repayment, credit_proposal_id)\u000a    VALUES (UUID(), '2021-01-25', 100.5, 90.3, 10.2, credit_proposal_id1),\u000a           (UUID(), '2021-02-25', 200.5, 180.3, 20.2, credit_proposal_id2),\u000a           (UUID(), '2021-03-25', 300.5, 270.3, 30.2, credit_proposal_id3);\u000aEND
INSERT INTO BANKS VALUES('94e97328-ad1c-485f-90fd-d951ac0650e5')
INSERT INTO BANKS VALUES('4e04d5c2-9647-47be-926d-ffb48e0a131d')
INSERT INTO CUSTOMERS VALUES('197a65d0-8e59-4195-a0d6-ca6f43d474e2','fio1','phone1','email1','pas1','94e97328-ad1c-485f-90fd-d951ac0650e5')
INSERT INTO CUSTOMERS VALUES('205f4a1f-4119-4173-92e3-be77f6681661','fio2','phone2','email2','pas2','94e97328-ad1c-485f-90fd-d951ac0650e5')
INSERT INTO CUSTOMERS VALUES('548d3fc5-e595-4c56-a3b2-4a6799d2c853','fio3','phone3','email3','pas3','4e04d5c2-9647-47be-926d-ffb48e0a131d')
INSERT INTO CREDITS VALUES('02bf6407-c193-4388-94d3-1ee9c95a4aa1',100,10,'94e97328-ad1c-485f-90fd-d951ac0650e5')
INSERT INTO CREDITS VALUES('c38ffcca-1be6-414d-a7b4-1c4260c38a99',200,20,'94e97328-ad1c-485f-90fd-d951ac0650e5')
INSERT INTO CREDITS VALUES('f66598af-5177-409b-9916-5318c453a5ce',300,30,'4e04d5c2-9647-47be-926d-ffb48e0a131d')
INSERT INTO CREDIT_PROPOSALS VALUES('aa97a48a-672a-4cb3-84d3-55c70a506089',50,'197a65d0-8e59-4195-a0d6-ca6f43d474e2','02bf6407-c193-4388-94d3-1ee9c95a4aa1')
INSERT INTO CREDIT_PROPOSALS VALUES('57c191d4-4d02-4d06-84fa-2d9dca197454',150,'205f4a1f-4119-4173-92e3-be77f6681661','c38ffcca-1be6-414d-a7b4-1c4260c38a99')
INSERT INTO CREDIT_PROPOSALS VALUES('9b5f313e-60b3-4abe-ab25-d2d60438d826',250,'548d3fc5-e595-4c56-a3b2-4a6799d2c853','f66598af-5177-409b-9916-5318c453a5ce')
INSERT INTO PAYMENTS VALUES('39d926a0-195d-4c54-836c-8a944fb2002c','2021-01-25',100,90,10,'aa97a48a-672a-4cb3-84d3-55c70a506089')
INSERT INTO PAYMENTS VALUES('21fe229b-4784-4f6e-8bf7-26e9dc0aa2cd','2021-02-25',200,180,20,'57c191d4-4d02-4d06-84fa-2d9dca197454')
INSERT INTO PAYMENTS VALUES('62225953-1b3d-4d5e-9bf9-ee69a7d9e63f','2021-03-25',300,270,30,'9b5f313e-60b3-4abe-ab25-d2d60438d826')
COMMIT
DISCONNECT
/*C26*/SET SCHEMA PUBLIC
DISCONNECT
/*C27*/SET SCHEMA PUBLIC
DISCONNECT
/*C14*/SET SCHEMA PUBLIC
DISCONNECT
/*C15*/SET SCHEMA PUBLIC
DISCONNECT
/*C16*/SET SCHEMA PUBLIC
DISCONNECT
/*C17*/SET SCHEMA PUBLIC
DISCONNECT
/*C18*/SET SCHEMA PUBLIC
DISCONNECT
/*C19*/SET SCHEMA PUBLIC
DISCONNECT
